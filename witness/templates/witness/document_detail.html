{# This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this file,
 # You can obtain one at http://mozilla.org/MPL/2.0/. #}
{% extends 'base.html' %}
{% block page_title %}
  {{ document_version.title }}
{% endblock %}

{% block main %}
<h1>{{ document_version.title }}</h1>
{% if document_version.is_retired %}
<h2>{% trans %}Retired{% endtrans %}</h2>
{% endif %}
{% if latest_version %}
<p>
{% trans latest_url=latest_version.get_absolute_url() %}
The latest version is available <a href="{{ latest_url }}">here</a>
{% endtrans %}
</p>
{% endif %}
  <div>{{ document_version.text|markdown }}</div>
  {% if user.is_authenticated() %}
    {% if latest_decision %}
      <p>
        {% trans action_text=latest_decision.action_text,
                 date=latest_decision.creation_time|date %}
          You chose "{{ action_text }}" on {{ date }}.
        {% endtrans %}
      </p>
    {% endif %}
    <p>
      {{ _('You will be signing this document with this identity:') }}
      {{ user.email }}
    </p>
    <form action='' method='post'>
      {{ csrf() }}
      {% if not latest_decision or not latest_decision.is_agreed %}
        <button type='submit' name='yes'>
          {{ document_version.yes_action_text }}
        </button>
      {% endif %}
      {% if not latest_decision or latest_decision.is_agreed %}
        <button type='submit' name='no'>
          {{ document_version.no_action_text }}
        </button>
      {% endif %}
    </form>
  {% else %}
    <p>
      <a id='browserid' href='#'>
        {{ _('Log in to sign this document.') }}
      </a>
    </p>
    <form action='{{ url('browserid_verify') }}' method='post'>
      {{ csrf() }}
      <input type='hidden' name='next'
        value='{{ request.build_absolute_uri() }}'>
      {{ browserid_form.as_p() }}
    </form>
  {% endif %}
{% endblock %}
